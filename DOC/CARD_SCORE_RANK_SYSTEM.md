# 카드 점수 및 등급 시스템

## 개요

생산 카드는 생성 시 기본 점수와 등급을 부여받으며, 이후 성과에 따라 점수가 변동하고 등급이 재계산됩니다.

## 기본 규칙

### 초기 값
- **기본 점수**: 100점
- **기본 등급**: C

### 카드 생성 시
- 새로 생산되는 모든 카드는 기본적으로 **100점, C 등급**을 부여받습니다.
- 중첩 카드 재활성 시에는 기존 점수와 등급을 유지합니다.

## 등급 체계

점수에 따라 다음 등급이 부여됩니다:

| 등급 | 점수 범위 | 설명 |
|------|----------|------|
| **F** | 0 ~ 59점 | 최하위 등급 |
| **E** | 60 ~ 79점 | 하위 등급 |
| **D** | 80 ~ 99점 | 중하위 등급 |
| **C** | 100 ~ 119점 | 기본 등급 (생산 시 기본값) |
| **B** | 120 ~ 139점 | 중위 등급 |
| **A** | 140 ~ 179점 | 상위 등급 |
| **S** | 180 ~ 219점 | 최상위 등급 |
| **+S** | 220 ~ 259점 | 특급 등급 |
| **++S** | 260 ~ 299점 | 초특급 등급 |
| **+SS** | 300점 이상 | 최고 등급 |

## 데이터 구조

### 카드 필드
```python
{
    'score': float,  # 카드 점수 (기본값: 100.0)
    'rank': str      # 카드 등급 (기본값: 'C')
}
```

### 등급 계산 함수
```python
def _calculate_rank_from_score(score: float) -> str:
    """
    점수에 따른 등급 계산
    
    Args:
        score: 카드 점수
        
    Returns:
        등급 문자열 (F, E, D, C, B, A, S, +S, ++S, +SS)
    """
```

## 구현 위치

### 파일
- `managers/production_card_manager.py`

### 주요 메서드

1. **`_calculate_rank_from_score(score: float) -> str`**
   - 점수를 입력받아 등급을 계산하여 반환

2. **`add_card(...)`**
   - 카드 생성 시 기본 점수 100점, 등급 C 부여
   - 중첩 카드 재활성 시 기존 점수/등급 유지

3. **`_data_to_card(data: Dict, metadata: Dict) -> Optional[Dict]`**
   - 카드 로드 시 점수/등급이 없으면 기본값 설정
   - 점수는 있지만 등급이 없으면 점수로부터 계산

## 저장 및 로드

### 저장
- 메타데이터에 `score`, `rank` 필드 저장
- NBverse 저장소에 영구 저장

### 로드
- 기존 카드에 점수/등급이 없으면 기본값(100점, C) 설정
- 점수는 있지만 등급이 없으면 점수로부터 자동 계산

## 사용 예시

### 카드 생성 시
```python
# 새 카드 생성 (자동으로 100점, C 등급 부여)
card = production_card_manager.add_card(
    timeframe='15m',
    nb_value=0.5,
    card_type='normal',
    chart_data={...}
)

# card['score'] = 100.0
# card['rank'] = 'C'
```

### 등급 계산
```python
# 점수로부터 등급 계산
rank = production_card_manager._calculate_rank_from_score(150.0)
# rank = 'A'
```

## 향후 확장 계획

점수 변동 로직은 향후 다음 요소들을 고려하여 구현될 예정입니다:
- 거래 성과 (손익률, 수익금액)
- 거래 빈도
- 보유 기간
- AI 추천 정확도
- 기타 성과 지표

## 변경 이력

- **v0.0.0.4**: 카드 점수/등급 시스템 초기 구현
  - 기본 점수 100점, 등급 C 부여
  - 등급 계산 함수 추가
  - 카드 데이터 구조에 score, rank 필드 추가

